<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dise√±ador de Ne√≥n</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Dancing+Script:wght@700&family=Satisfy&family=Permanent+Marker&family=Sacramento&family=Great+Vibes&family=Lobster&family=Abril+Fatface&family=Righteous&family=Orbitron:wght@700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#f2f0ec; --panel:#fff; --panel2:#f7f5f2;
  --border:#e4e0da; --border2:#ccc8c1;
  --accent:#d93b3e; --text:#1a1918; --muted:#8a8680;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;overflow:hidden;}
body{background:var(--bg);color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;display:flex;flex-direction:column;}

header{height:52px;flex-shrink:0;display:flex;align-items:center;justify-content:space-between;padding:0 24px;background:var(--panel);border-bottom:1px solid var(--border);}
.logo{font-size:.9rem;font-weight:800;letter-spacing:3px;text-transform:uppercase;}
.logo em{color:var(--accent);font-style:normal;}
.header-mid{font-size:.6rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--muted);}
.dots{display:flex;gap:5px;}
.dot{width:7px;height:7px;border-radius:50%;background:var(--border2);transition:.3s;}
.dot.on{background:var(--accent);transform:scale(1.2);}

.layout{flex:1;display:grid;grid-template-columns:305px 1fr;overflow:hidden;min-height:0;}

.sidebar{background:var(--panel);border-right:1px solid var(--border);overflow-y:auto;overflow-x:hidden;}
.sidebar::-webkit-scrollbar{width:3px;}
.sidebar::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

.block{padding:14px 16px;border-bottom:1px solid var(--border);}
.bhead{display:flex;align-items:center;gap:7px;margin-bottom:10px;}
.num{width:18px;height:18px;border-radius:50%;background:var(--accent);color:#fff;font-size:.55rem;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.blabel{font-size:.58rem;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:var(--muted);}

textarea{width:100%;background:var(--panel2);border:1.5px solid var(--border);border-radius:7px;color:var(--text);font-size:.9rem;padding:9px 11px;resize:none;height:72px;font-family:inherit;outline:none;transition:border-color .18s;line-height:1.5;}
textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(217,59,62,.09);}
.char-row{display:flex;justify-content:space-between;margin-top:5px;font-size:.58rem;color:var(--muted);}

.font-grid{display:grid;grid-template-columns:1fr 1fr;gap:5px;}
.fbtn{background:var(--panel2);border:1.5px solid var(--border);border-radius:7px;height:42px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:.92rem;color:var(--text);transition:all .15s;overflow:hidden;padding:0 5px;}
.fbtn:hover{border-color:var(--accent);background:rgba(217,59,62,.04);}
.fbtn.on{border-color:var(--accent);background:rgba(217,59,62,.09);color:var(--accent);}

.color-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:7px;}
.cswatch{aspect-ratio:1;border-radius:50%;cursor:pointer;border:2.5px solid transparent;transition:all .15s;box-shadow:0 1px 4px rgba(0,0,0,.14);}
.cswatch:hover{transform:scale(1.14);}
.cswatch.on{border-color:#111;transform:scale(1.12);box-shadow:0 0 0 3px rgba(0,0,0,.11);}
.clabel{font-size:.62rem;color:var(--muted);text-align:center;margin-top:6px;}

.wall-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:5px;}
.wbtn{aspect-ratio:.75;border-radius:7px;cursor:pointer;border:2.5px solid transparent;overflow:hidden;position:relative;background-size:cover;background-position:center top;transition:all .18s;}
.wbtn:hover{transform:scale(1.04);box-shadow:0 4px 14px rgba(0,0,0,.25);}
.wbtn.on{border-color:var(--accent);box-shadow:0 0 0 3px rgba(217,59,62,.22);}
.wbtn span{position:absolute;bottom:0;left:0;right:0;padding:3px 4px 4px;background:linear-gradient(transparent,rgba(0,0,0,.7));font-size:.48rem;font-weight:700;text-transform:uppercase;letter-spacing:.3px;color:rgba(255,255,255,.95);text-align:center;}

.mount-grid{display:grid;grid-template-columns:1fr 1fr;gap:5px;}
.mbtn{background:var(--panel2);border:1.5px solid var(--border);border-radius:7px;padding:9px 6px;cursor:pointer;text-align:center;font-size:.62rem;font-weight:600;color:var(--muted);font-family:inherit;line-height:1.4;transition:all .15s;}
.mbtn:hover{border-color:var(--accent);color:var(--text);}
.mbtn.on{border-color:var(--accent);color:var(--accent);background:rgba(217,59,62,.07);}
.mico{font-size:1.15rem;display:block;margin-bottom:2px;}

.extras{display:flex;flex-direction:column;gap:10px;}
.trow{display:flex;justify-content:space-between;align-items:center;}
.tname{font-size:.75rem;font-weight:600;color:var(--text);}
.tdesc{font-size:.6rem;color:var(--muted);margin-top:1px;}
.toggle{position:relative;width:38px;height:21px;cursor:pointer;flex-shrink:0;}
.toggle input{opacity:0;width:0;height:0;}
.tslider{position:absolute;inset:0;background:var(--border2);border-radius:21px;transition:.25s;}
.tslider::before{content:'';position:absolute;left:3px;top:3px;width:15px;height:15px;border-radius:50%;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,.2);transition:.25s;}
.toggle input:checked+.tslider{background:var(--accent);}
.toggle input:checked+.tslider::before{transform:translateX(17px);}

.preview-col{display:flex;flex-direction:column;overflow:hidden;min-height:0;}
.preview-bar{height:44px;flex-shrink:0;display:flex;align-items:center;justify-content:space-between;padding:0 18px;background:var(--panel);border-bottom:1px solid var(--border);gap:8px;}
.bar-label{font-size:.58rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted);}
.bar-actions{display:flex;gap:6px;}
.ibtn{background:var(--panel2);border:1.5px solid var(--border);border-radius:6px;padding:5px 11px;font-size:.65rem;font-weight:600;font-family:inherit;color:var(--muted);cursor:pointer;display:flex;align-items:center;gap:4px;transition:all .15s;}
.ibtn:hover{border-color:var(--accent);color:var(--accent);}

.preview-canvas{flex:1;min-height:0;position:relative;overflow:hidden;background-size:cover;background-position:center;cursor:default;}
.canvas-overlay{position:absolute;inset:0;background:rgba(0,0,0,.38);pointer-events:none;z-index:1;transition:background .3s;}

#signWrapper{
  position:absolute;
  z-index:10;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  transform-origin:center center;
  cursor:grab;user-select:none;touch-action:none;
  overflow:visible;
  width:max-content;   /* ancho dictado por el contenido, nunca por el padre */
}
#signWrapper:active{cursor:grabbing;}

#mountPlate{position:absolute;pointer-events:none;opacity:0;}
#mountHook{position:absolute;left:50%;transform:translateX(-50%);pointer-events:none;display:none;z-index:-1;}
#mountBase{position:absolute;left:50%;bottom:-30px;transform:translateX(-50%);pointer-events:none;display:none;z-index:-1;}
#mountScrews{position:absolute;inset:-6px -8px;pointer-events:none;display:none;}
.screw{position:absolute;width:9px;height:9px;border-radius:50%;background:#aaa;border:2px solid #777;box-shadow:inset 0 1px 2px rgba(255,255,255,.5),0 1px 3px rgba(0,0,0,.4);}
.screw::after{content:'';position:absolute;inset:1px;background:linear-gradient(135deg,#999 40%,#666);border-radius:50%;}

#acrylicCanvas{
  position:absolute;
  z-index:1;
  pointer-events:none;
  opacity:0;
  transition:opacity .3s;
  filter:drop-shadow(0 0 12px rgba(255,255,255,.25));
}

/* neonText: display inline-block + nowrap ‚Üí el ancho lo dicta el texto,
   nunca el contenedor padre. El wrapper escala todo uniformemente. */
#neonText{
  display:inline-block;
  text-align:center;
  line-height:1.2;
  white-space:pre;
  padding:16px 28px;
  pointer-events:auto;
  position:relative;
  z-index:2;
  transition:color .2s,text-shadow .2s;
}

#resizeHandle{position:absolute;bottom:-8px;right:-8px;width:22px;height:22px;background:var(--accent);border-radius:50%;cursor:se-resize;border:2.5px solid #fff;box-shadow:0 2px 8px rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:20;transition:transform .15s;}
#resizeHandle:hover{transform:scale(1.2);}
#resizeHandle svg{width:10px;height:10px;}

#sizeHint{position:absolute;top:-28px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.7);color:#fff;font-size:.6rem;font-weight:700;letter-spacing:.5px;padding:3px 8px;border-radius:5px;white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .2s;}
#signWrapper:hover #sizeHint{opacity:1;}

.dim-badge{position:absolute;bottom:12px;right:14px;z-index:3;background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.14);border-radius:5px;padding:4px 10px;font-size:.63rem;font-weight:600;color:rgba(255,255,255,.65);backdrop-filter:blur(5px);letter-spacing:.3px;}
.scroll-hint{position:absolute;bottom:12px;left:14px;z-index:3;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.1);border-radius:5px;padding:4px 9px;font-size:.58rem;color:rgba(255,255,255,.5);backdrop-filter:blur(4px);pointer-events:none;}

@keyframes flicker{0%,93%,100%{opacity:1;}94%{opacity:.7;}95%{opacity:1;}97%{opacity:.42;}98%{opacity:1;}}
.flicker{animation:flicker 5s infinite;}
.dimmed{opacity:.55;}

#rainCanvas{position:absolute;inset:0;pointer-events:none;z-index:5;display:none;}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESPONSIVE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
@media (max-width:768px){
  html,body{overflow:hidden;height:100%;}
  header{padding:0 14px;height:46px;}
  .logo{font-size:.75rem;letter-spacing:2px;}
  .header-mid{display:none;}
  .layout{grid-template-columns:1fr;grid-template-rows:1fr auto;overflow:hidden;}
  .preview-col{grid-row:1;min-height:0;position:relative;}
  .preview-bar{height:38px;padding:0 10px;}
  .bar-label{display:none;}
  .ibtn{padding:4px 8px;font-size:.6rem;}
  .ibtn .btn-text{display:none;}
  .sidebar{grid-row:2;border-right:none;border-top:1px solid var(--border);overflow:hidden;display:flex;flex-direction:column;height:var(--sheet-h,52px);transition:height .35s cubic-bezier(.4,0,.2,1);position:relative;background:var(--panel);z-index:50;}
  .sheet-handle{display:flex;flex-direction:column;align-items:center;padding:8px 0 4px;cursor:pointer;flex-shrink:0;gap:2px;}
  .sheet-pill{width:36px;height:4px;border-radius:2px;background:var(--border2);}
  .sheet-tabs{display:flex;gap:0;width:100%;overflow-x:auto;overflow-y:hidden;scrollbar-width:none;border-bottom:1px solid var(--border);flex-shrink:0;}
  .sheet-tabs::-webkit-scrollbar{display:none;}
  .stab{flex-shrink:0;padding:5px 12px;font-size:.55rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;white-space:nowrap;background:none;border-top:none;border-left:none;border-right:none;font-family:inherit;}
  .stab.on{color:var(--accent);border-bottom-color:var(--accent);}
  .sheet-content{flex:1;overflow-y:auto;overflow-x:hidden;}
  .block{display:none;}
  .block.active{display:block;}
  .font-grid{grid-template-columns:repeat(3,1fr);}
  .wall-grid{grid-template-columns:repeat(4,1fr);}
  .color-grid{grid-template-columns:repeat(6,1fr);}
  #resizeHandle{width:28px;height:28px;bottom:-10px;right:-10px;}
  #sizeHint{opacity:1;font-size:.52rem;}
}
@media (max-width:380px){
  .font-grid{grid-template-columns:1fr 1fr;}
  .wall-grid{grid-template-columns:repeat(3,1fr);}
}

/* ‚ïê‚ïê‚ïê CHAR EDIT ‚ïê‚ïê‚ïê */
.nchar{
  display:inline;
  cursor:pointer;
  position:relative;
  transition:text-shadow .15s;
}
.nchar.selected{
  outline:2px solid rgba(255,255,255,.5);
  outline-offset:3px;
  border-radius:3px;
}
.nchar-nl{ display:block; height:0; }

#charMenu{
  position:absolute;
  z-index:100;
  background:rgba(12,13,18,.95);
  border:1px solid rgba(255,255,255,.12);
  border-radius:10px;
  padding:8px 10px;
  box-shadow:0 8px 28px rgba(0,0,0,.75);
  backdrop-filter:blur(14px);
  pointer-events:auto;
  display:none;
  white-space:nowrap;
}
#charMenu.visible{ display:flex; align-items:center; gap:8px; }
#charMenu::after{
  content:'';
  position:absolute;
  top:100%; left:50%;
  transform:translateX(-50%);
  border:6px solid transparent;
  border-top-color:rgba(12,13,18,.95);
}

/* Carrusel de fuentes */
.cmenu-carousel{
  display:flex;
  align-items:center;
  gap:4px;
}
.cmenu-arr{
  background:none;
  border:none;
  color:rgba(255,255,255,.5);
  font-size:1rem;
  cursor:pointer;
  padding:0 2px;
  line-height:1;
  transition:color .12s;
  flex-shrink:0;
}
.cmenu-arr:hover{ color:#fff; }
.cmenu-font-name{
  font-size:.82rem;
  color:#fff;
  min-width:80px;
  text-align:center;
  padding:4px 8px;
  background:rgba(255,255,255,.08);
  border-radius:6px;
  border:1px solid rgba(255,255,255,.12);
  cursor:default;
}

/* Separador */
.cmenu-sep{
  width:1px;
  height:24px;
  background:rgba(255,255,255,.12);
  flex-shrink:0;
}

/* Swatch de color activo + submenu */
.cmenu-color-wrap{
  position:relative;
}
.cmenu-color-btn{
  width:22px; height:22px;
  border-radius:50%;
  border:2px solid rgba(255,255,255,.5);
  cursor:pointer;
  transition:transform .12s;
  flex-shrink:0;
  display:block;
}
.cmenu-color-btn:hover{ transform:scale(1.15); }
.cmenu-color-sub{
  position:absolute;
  bottom:calc(100% + 10px);
  left:50%;
  transform:translateX(-50%);
  background:rgba(12,13,18,.97);
  border:1px solid rgba(255,255,255,.12);
  border-radius:10px;
  padding:8px;
  display:none;
  flex-wrap:wrap;
  gap:6px;
  width:154px;
  box-shadow:0 6px 24px rgba(0,0,0,.8);
}
.cmenu-color-sub.open{ display:flex; }
.cmenu-color-sub::after{
  content:'';
  position:absolute;
  top:100%; left:50%;
  transform:translateX(-50%);
  border:6px solid transparent;
  border-top-color:rgba(12,13,18,.97);
}
.cmenu-csw{
  width:20px; height:20px;
  border-radius:50%;
  cursor:pointer;
  border:2px solid transparent;
  transition:all .12s;
  flex-shrink:0;
}
.cmenu-csw:hover{ transform:scale(1.18); }
.cmenu-csw.on{ border-color:#fff; transform:scale(1.1); }

/* Reset */
.cmenu-reset{
  background:none;
  border:none;
  color:rgba(255,255,255,.35);
  font-size:.85rem;
  cursor:pointer;
  padding:0 2px;
  transition:color .12s;
  line-height:1;
  flex-shrink:0;
}
.cmenu-reset:hover{ color:rgba(255,100,100,.8); }
</style>
</head>
<body>

<header>
  <div class="logo">ILUMIA<em>MX</em></div>
  <div class="header-mid">Dise√±ador de Letreros</div>
  <div class="dots">
    <div class="dot on" id="d1"></div><div class="dot" id="d2"></div>
    <div class="dot" id="d3"></div><div class="dot" id="d4"></div>
    <div class="dot" id="d5"></div><div class="dot" id="d6"></div>
  </div>
</header>

<div class="layout">
<aside class="sidebar" id="sidebar">
  <div class="sheet-handle" id="sheetHandle" style="display:none"><div class="sheet-pill"></div></div>
  <div class="sheet-tabs" id="sheetTabs" style="display:none"></div>
  <div class="sheet-content" id="sheetContent">

  <div class="block" data-tab="Texto" data-idx="0">
    <div class="bhead"><span class="num">1</span><span class="blabel">Tu Texto</span></div>
    <textarea id="textInput" placeholder="Escribe tu texto aqu√≠&#10;(Enter = nueva l√≠nea)">Hello World</textarea>
    <div class="char-row"><span id="charCount">11 caracteres</span><span>M√°x. 60</span></div>
  </div>

  <div class="block" data-tab="Fuente" data-idx="1">
    <div class="bhead"><span class="num">2</span><span class="blabel">Tipograf√≠a</span></div>
    <div class="font-grid" id="fontGrid">
      <div class="fbtn on"  data-font="Pacifico"         style="font-family:'Pacifico'">Pacifico</div>
      <div class="fbtn"     data-font="Dancing Script"   style="font-family:'Dancing Script'">Dancing</div>
      <div class="fbtn"     data-font="Satisfy"          style="font-family:'Satisfy'">Satisfy</div>
      <div class="fbtn"     data-font="Permanent Marker" style="font-family:'Permanent Marker'">Marker</div>
      <div class="fbtn"     data-font="Sacramento"       style="font-family:'Sacramento';font-size:1.1rem">Sacramento</div>
      <div class="fbtn"     data-font="Great Vibes"      style="font-family:'Great Vibes';font-size:1.1rem">Great Vibes</div>
      <div class="fbtn"     data-font="Lobster"          style="font-family:'Lobster'">Lobster</div>
      <div class="fbtn"     data-font="Abril Fatface"    style="font-family:'Abril Fatface'">Abril</div>
      <div class="fbtn"     data-font="Righteous"        style="font-family:'Righteous'">Righteous</div>
      <div class="fbtn"     data-font="Orbitron"         style="font-family:'Orbitron';font-size:.68rem">ORBITRON</div>
    </div>
  </div>

  <div class="block" data-tab="Color" data-idx="2">
    <div class="bhead"><span class="num">3</span><span class="blabel">Color del Ne√≥n</span></div>
    <div class="color-grid" id="colorGrid">
      <div class="cswatch on" style="background:#b3f0ff" data-c="#b3f0ff" data-n="Azul Hielo"></div>
      <div class="cswatch"    style="background:#ff2222" data-c="#ff2222" data-n="Roja"></div>
      <div class="cswatch"    style="background:#ffb300" data-c="#ffb300" data-n="Amber"></div>
      <div class="cswatch"    style="background:#e8ff00" data-c="#e8ff00" data-n="Amarillo Lim√≥n"></div>
      <div class="cswatch"    style="background:#bf00ff" data-c="#bf00ff" data-n="Morado"></div>
      <div class="cswatch"    style="background:#00ff88" data-c="#00ff88" data-n="Verde"></div>
      <div class="cswatch"    style="background:#39ff14" data-c="#39ff14" data-n="Verde Mars"></div>
      <div class="cswatch"    style="background:#3b82f6" data-c="#3b82f6" data-n="Azul"></div>
      <div class="cswatch"    style="background:#ff3cac" data-c="#ff3cac" data-n="Rosa"></div>
      <div class="cswatch"    style="background:#ffd700" data-c="#ffd700" data-n="Amarillo Dorado"></div>
      <div class="cswatch"    style="background:#ff8800" data-c="#ff8800" data-n="Naranja"></div>
      <div class="cswatch"    style="background:#e8f4ff" data-c="#e8f4ff" data-n="Blanca Fr√≠a"></div>
    </div>
    <div class="clabel" id="colorLabel">Azul Hielo</div>
  </div>

  <div class="block" data-tab="Pared" data-idx="3">
    <div class="bhead"><span class="num">4</span><span class="blabel">Pared / Ambiente</span></div>
    <div class="wall-grid" id="wallGrid">
      <div class="wbtn on" style="background-image:url('https://images.unsplash.com/photo-1770816306935-d0a08e93d823?w=400&q=80&fit=crop')" data-url="https://images.unsplash.com/photo-1770816306935-d0a08e93d823?w=1400&q=85" data-ov=".25"><span>Local 1</span></div>
      <div class="wbtn" style="background-image:url('https://plus.unsplash.com/premium_photo-1728155006673-887f27d7694f?w=400&q=80&fit=crop')" data-url="https://plus.unsplash.com/premium_photo-1728155006673-887f27d7694f?w=1400&q=85" data-ov=".30"><span>Local 2</span></div>
      <div class="wbtn" style="background-image:url('https://images.unsplash.com/photo-1769501203673-159257ecb72d?w=400&q=80&fit=crop')" data-url="https://images.unsplash.com/photo-1769501203673-159257ecb72d?w=1400&q=85" data-ov=".28"><span>Local 3</span></div>
      <div class="wbtn" style="background-image:url('https://images.unsplash.com/photo-1770646403987-64cf5c08c870?w=400&q=80&fit=crop')" data-url="https://images.unsplash.com/photo-1770646403987-64cf5c08c870?w=1400&q=85" data-ov=".32"><span>Local 4</span></div>
      <div class="wbtn" style="background-image:url('https://images.unsplash.com/photo-1770319675686-ae3b11647bcd?w=400&q=80&fit=crop')" data-url="https://images.unsplash.com/photo-1770319675686-ae3b11647bcd?w=1400&q=85" data-ov=".28"><span>Local 5</span></div>
      <div class="wbtn" style="background-image:url('https://plus.unsplash.com/premium_photo-1683121299733-06eed1e7df79?w=400&q=80&fit=crop')" data-url="https://plus.unsplash.com/premium_photo-1683121299733-06eed1e7df79?w=1400&q=85" data-ov=".35"><span>Local 6</span></div>
      <div class="wbtn" style="background-image:url('https://images.unsplash.com/photo-1526887593587-a307ea5d46b4?w=400&q=80&fit=crop')" data-url="https://images.unsplash.com/photo-1526887593587-a307ea5d46b4?w=1400&q=85" data-ov=".30"><span>Local 7</span></div>
      <div class="wbtn" style="background-image:url('https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400&q=80&fit=crop')" data-url="https://images.unsplash.com/photo-1566073771259-6a8506099945?w=1400&q=85" data-ov=".28"><span>Hotel Lobby</span></div>
    </div>
  </div>

  <div class="block" data-tab="Montaje" data-idx="4">
    <div class="bhead"><span class="num">5</span><span class="blabel">Tipo de Montaje</span></div>
    <div class="mount-grid" id="mountGrid">
      <button class="mbtn on" data-m="libre"><span class="mico">‚ú®</span>Sin sujeci√≥n<br><small style="font-size:.55rem;opacity:.7">S√≥lo el letrero</small></button>
      <button class="mbtn" data-m="colgar"><span class="mico">ü™ù</span>Para colgar<br><small style="font-size:.55rem;opacity:.7">Cable colgante</small></button>
      <button class="mbtn" data-m="acrilico-cuadrado"><span class="mico">‚¨ú</span>Acr√≠lico Cuadrado<br><small style="font-size:.55rem;opacity:.7">Placa rectangular</small></button>
      <button class="mbtn" data-m="acrilico-redondo"><span class="mico">‚≠ï</span>Acr√≠lico Redondo<br><small style="font-size:.55rem;opacity:.7">Placa circular</small></button>
    </div>
  </div>

  <div class="block" data-tab="Extras" data-idx="5">
    <div class="bhead"><span class="num">6</span><span class="blabel">Opciones Adicionales</span></div>
    <div class="extras">
      <div class="trow">
        <div><div class="tname">Backing Acr√≠lico</div><div class="tdesc">Placa recortada en la forma exacta del texto</div></div>
        <label class="toggle"><input type="checkbox" id="tBacking"><span class="tslider"></span></label>
      </div>
      <div class="trow">
        <div><div class="tname">RGB Multicolor</div><div class="tdesc">Ciclo de colores animado</div></div>
        <label class="toggle"><input type="checkbox" id="tRgb"><span class="tslider"></span></label>
      </div>
      <div class="trow">
        <div><div class="tname">Efecto Parpadeo</div><div class="tdesc">Animaci√≥n vintage de ne√≥n cl√°sico</div></div>
        <label class="toggle"><input type="checkbox" id="tFlicker"><span class="tslider"></span></label>
      </div>
      <div class="trow">
        <div><div class="tname">Control de Brillo</div><div class="tdesc">Simula intensidad baja ‚Äî dimmer f√≠sico incluido</div></div>
        <label class="toggle"><input type="checkbox" id="tDimmer"><span class="tslider"></span></label>
      </div>

      <div class="trow" style="padding-top:10px;border-top:1px solid var(--border);margin-top:2px;">
        <div><div class="tname" style="font-size:.85rem;">üí° Ne√≥n Encendido</div><div class="tdesc">Apaga para ver el letrero sin luz</div></div>
        <label class="toggle"><input type="checkbox" id="tPower" checked><span class="tslider"></span></label>
      </div>
    </div>
  </div>
  </div>
</aside>

<div class="preview-col">
  <div class="preview-bar">
    <div class="bar-label">Vista previa ¬∑ Arrastra y redimensiona el letrero</div>
    <div class="bar-actions">
      <button class="ibtn" id="btnFlicker" onclick="toggleFlicker()">‚ö° <span class="btn-text">Parpadeo</span></button>
      <button class="ibtn" onclick="resetPosition()">‚äô <span class="btn-text">Centrar</span></button>
      <button class="ibtn" onclick="downloadPreview()">‚¨á <span class="btn-text">Guardar</span></button>
      <button class="ibtn" id="btnShare" onclick="shareDesign()">üîó <span class="btn-text">Compartir</span></button>
    </div>
  </div>
  <div class="preview-canvas" id="previewCanvas"
    style="background-image:url('https://images.unsplash.com/photo-1770816306935-d0a08e93d823?w=1400&q=85')">
    <div class="canvas-overlay" id="canvasOverlay"></div>
    <canvas id="rainCanvas"></canvas>
    <div id="signWrapper">
      <div id="sizeHint">‚Üê arrastra ¬∑ esquina para redimensionar ‚Üí</div>
      <div id="mountPlate"></div>
      <div id="mountHook"></div>
      <div id="mountBase"></div>
      <div id="mountScrews"></div>
      <canvas id="acrylicCanvas"></canvas>
      <div id="neonText" style="font-family:'Pacifico'">Hello World</div>
      <div id="charMenu">
  <!-- Carrusel fuente -->
  <div class="cmenu-carousel">
    <button class="cmenu-arr" id="cmenuPrev">‚Äπ</button>
    <div class="cmenu-font-name" id="cmenuFontName">Pacifico</div>
    <button class="cmenu-arr" id="cmenuNext">‚Ä∫</button>
  </div>
  <div class="cmenu-sep"></div>
  <!-- Color -->
  <div class="cmenu-color-wrap">
    <div class="cmenu-color-btn" id="cmenuColorBtn"></div>
    <div class="cmenu-color-sub" id="cmenuColorSub"></div>
  </div>
  <div class="cmenu-sep"></div>
  <!-- Reset -->
  <button class="cmenu-reset" id="cmenuReset" title="Restablecer">‚Ü∫</button>
</div>
<div id="resizeHandle">
        <svg viewBox="0 0 10 10"><line x1="2" y1="8" x2="8" y2="2" stroke="white" stroke-width="1.5" stroke-linecap="round"/><line x1="5" y1="8" x2="8" y2="5" stroke="white" stroke-width="1.5" stroke-linecap="round"/></svg>
      </div>
    </div>
    <div class="dim-badge" id="dimBadge">~ 60 √ó 20 cm</div>
    <div class="scroll-hint" id="scrollHint">üñ± Rueda del rat√≥n = redimensionar</div>
  </div>
</div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const S = {
  text:'Hello World', font:'Pacifico', color:'#b3f0ff',
  scale:1, posX:0, posY:0, bgX:50, bgY:50,
  mount:'libre',
  backing:false, rgb:false, flicker:false, dimmer:false, power:true,
  charOverrides:{},  // idx ‚Üí {font, color}
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DOM REFS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const neonEl        = document.getElementById('neonText');
const signWrapper   = document.getElementById('signWrapper');
const previewCanvas = document.getElementById('previewCanvas');
const overlay       = document.getElementById('canvasOverlay');
const mountPlate    = document.getElementById('mountPlate');
const mountHook     = document.getElementById('mountHook');
const mountBase     = document.getElementById('mountBase');
const mountScrews   = document.getElementById('mountScrews');
const rainCvs       = document.getElementById('rainCanvas');
const rainCtx       = rainCvs.getContext('2d');
const acrylicCvs    = document.getElementById('acrylicCanvas');
const acrylicCtx    = acrylicCvs.getContext('2d');

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FONT-SIZE DIN√ÅMICO
// El tama√±o base se calcula seg√∫n el ancho real del canvas y la
// longitud del texto, para que en m√≥vil NUNCA desborde ni se deforme.
// S.scale es el "zoom" manual del usuario encima de este tama√±o base.
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function calcBaseFontSize() {
  const cw = previewCanvas.offsetWidth  || 800;
  const ch = previewCanvas.offsetHeight || 400;

  const lines  = (S.text || 'A').split('\n');
  const maxLen = Math.max(...lines.map(l => l.length), 1);

  // Fuentes script/display tienen ~0.58 de avance por car√°cter a 1px
  const fsFromW = (cw * 0.78) / (maxLen * 0.58);
  // Vertical: el bloque no debe pasar del 65% del alto del canvas
  const fsFromH = (ch * 0.65) / (lines.length * 1.2);

  // Techo: 72px en desktop, 48px en m√≥vil (canvas < 600px ancho)
  const fsCeil = cw < 600 ? 48 : 72;

  return Math.max(14, Math.min(fsCeil, fsFromW, fsFromH));
}

// Variable que guarda el BASE_FS calculado actualmente (lo usan
// _renderAcrylic y renderNeon para que est√©n sincronizados)
let currentFS = 72;

// Recalcula currentFS y re-renderiza. Llamar SOLO cuando cambia
// el texto o la fuente ‚Äî NUNCA por resize de ventana.
function recalcFontSize(){
  currentFS = calcBaseFontSize();
  renderNeon();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RGB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const RGB_COLORS = ['#ff3cac','#00f5ff','#00ff88','#ffee00','#ff8800','#bf00ff','#3b82f6'];
let rgbInt = null, ri = 0, currentRGBColor = RGB_COLORS[0];

function startRGB(){
  rgbInt = setInterval(()=>{
    currentRGBColor = RGB_COLORS[ri++ % RGB_COLORS.length];
    neonEl.style.color = currentRGBColor;
    neonEl.style.textShadow = `0 0 4px ${currentRGBColor},0 0 10px ${currentRGBColor},0 0 24px ${currentRGBColor},0 0 50px ${currentRGBColor}`;
    if(S.backing) drawAcrylic();
  }, 700);
}
function stopRGB(){ clearInterval(rgbInt); currentRGBColor = RGB_COLORS[0]; renderNeon(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACRYLIC ‚Äî anillo que sigue la silueta del texto
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let acrylicRaf = null;

function drawAcrylic(){
  if(!S.backing){ acrylicCvs.style.opacity='0'; return; }
  cancelAnimationFrame(acrylicRaf);
  // Dos frames: 1¬∫ DOM actualiza font-size, 2¬∫ browser re-calcula offsetWidth/Height
  acrylicRaf = requestAnimationFrame(()=> requestAnimationFrame(()=> _renderAcrylic()));
}

function _renderAcrylic(){
  const PAD = 44;
  const nW = neonEl.offsetWidth;
  const nH = neonEl.offsetHeight;
  const nL = neonEl.offsetLeft;
  const nT = neonEl.offsetTop;
  const cvW = nW + PAD * 2;
  const cvH = nH + PAD * 2;

  acrylicCvs.width          = cvW;
  acrylicCvs.height         = cvH;
  acrylicCvs.style.width    = cvW + 'px';
  acrylicCvs.style.height   = cvH + 'px';
  acrylicCvs.style.left     = (nL - PAD) + 'px';
  acrylicCvs.style.top      = (nT - PAD) + 'px';
  acrylicCvs.style.position = 'absolute';

  // ‚Äî Reproducir el texto exactamente como el CSS de neonEl ‚Äî
  // CSS: font-size = currentFS px, line-height 1.2, padding 16px 28px
  const lines   = (S.text || ' ').split('\n');
  const fs      = currentFS;   // ‚Üê usa el mismo fs que renderNeon aplic√≥
  const lh      = fs * 1.2;

  const off = new OffscreenCanvas(cvW, cvH);
  const ox  = off.getContext('2d');
  ox.font         = `${fs}px '${S.font}', cursive`;
  ox.textAlign    = 'center';
  ox.textBaseline = 'alphabetic';
  ox.fillStyle    = '#fff';

  // M√©tricas reales de la fuente
  const met         = ox.measureText('Mg');
  const ascent      = met.fontBoundingBoxAscent  || fs * 0.78;
  const descent     = met.fontBoundingBoxDescent || fs * 0.22;
  const halfLeading = (lh - (ascent + descent)) / 2;

  // Baseline de la primera l√≠nea:
  // PAD (margen canvas) + 16 (padding-top CSS) + halfLeading + ascent
  const firstBaseline = PAD + 16 + halfLeading + ascent;

  lines.forEach((ln, i) => ox.fillText(ln || ' ', cvW / 2, firstBaseline + i * lh));

  // ‚Äî Dilatar la silueta ‚Äî
  function threshold(src, blurR, thr){
    const s = new OffscreenCanvas(cvW, cvH);
    const c = s.getContext('2d');
    c.filter = `blur(${blurR}px)`; c.drawImage(src, 0, 0); c.filter = 'none';
    const id = c.getImageData(0, 0, cvW, cvH), d = id.data;
    for(let i = 3; i < d.length; i += 4) d[i] = d[i] > thr ? 255 : 0;
    c.putImageData(id, 0, 0);
    return s;
  }

  const silOuter = threshold(off,      16,  15);  // dilatado ‚Üí contorno exterior
  const silInner = threshold(silOuter,  3, 180);  // erosionado ‚Üí interior

  // ‚Äî Silueta completa (silOuter) con estilo acr√≠lico transl√∫cido ‚Äî
  const ring = new OffscreenCanvas(cvW, cvH);
  const rc   = ring.getContext('2d');
  // Gradiente acr√≠lico igual que los montajes de placa
  const grad = rc.createLinearGradient(0, 0, cvW * 0.7, cvH);
  grad.addColorStop(0,   'rgba(220,230,245,0.22)');
  grad.addColorStop(0.5, 'rgba(180,195,220,0.15)');
  grad.addColorStop(1,   'rgba(200,215,235,0.20)');
  rc.fillStyle = grad;
  rc.fillRect(0, 0, cvW, cvH);
  // Recortar a la silueta exterior del texto
  rc.globalCompositeOperation = 'destination-in';
  rc.drawImage(silOuter, 0, 0);

  // Borde brillante interior: l√≠nea blanca transl√∫cida en el borde de la silueta
  const rim = new OffscreenCanvas(cvW, cvH);
  const rm  = rim.getContext('2d');
  rm.fillStyle = 'rgba(255,255,255,0.28)';
  rm.fillRect(0, 0, cvW, cvH);
  rm.globalCompositeOperation = 'destination-in';
  rm.drawImage(silOuter, 0, 0);
  rm.globalCompositeOperation = 'destination-out';
  rm.drawImage(silInner, 0, 0);

  acrylicCtx.clearRect(0, 0, cvW, cvH);
  acrylicCtx.drawImage(ring, 0, 0);
  acrylicCtx.drawImage(rim,  0, 0);
  acrylicCvs.style.filter  = 'drop-shadow(0 4px 20px rgba(0,0,0,0.5))';
  acrylicCvs.style.opacity = '1';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER NEON TEXT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildNeonSpans(){
  // Cada car√°cter ‚Üí <span class="nchar"> con sus overrides propios
  neonEl.innerHTML = '';
  const chars = S.text || ' ';
  for(let i = 0; i < chars.length; i++){
    const ch = chars[i];
    if(ch === '\n'){
      const br = document.createElement('span');
      br.className = 'nchar-nl';
      neonEl.appendChild(br);
      continue;
    }
    const sp = document.createElement('span');
    sp.className = 'nchar';
    sp.dataset.idx = i;
    sp.textContent = ch === ' ' ? '\u00A0' : ch; // preserve space width
    // Aplicar overrides individuales si existen
    const ov = S.charOverrides[i];
    if(ov){
      if(ov.font) sp.style.fontFamily = `'${ov.font}', cursive`;
      if(ov.color){
        sp.style.color = ov.color;
        if(S.power){
          const c = ov.color;
          sp.style.textShadow = `0 0 5px ${c},0 0 10px ${c},0 0 20px ${c},0 0 40px ${c},0 0 80px ${c}`;
        }
      }
    }
    neonEl.appendChild(sp);
  }
}

function renderNeon(){
  // Aplica currentFS tal como est√° ‚Äî solo se recalcula cuando
  // el usuario cambia el texto o la fuente (no en resize)
  neonEl.style.fontFamily = `'${S.font}', cursive`;
  neonEl.style.fontSize   = currentFS + 'px';

  signWrapper.style.left      = `calc(50% + ${S.posX}px)`;
  signWrapper.style.top       = `calc(50% + ${S.posY}px)`;
  signWrapper.style.transform = `translate(-50%,-50%) scale(${S.scale})`;

  if(!S.power){
    neonEl.style.color = '#5a5a5a';
    neonEl.style.textShadow = 'none';
    buildNeonSpans();
    // overrides: sin glow cuando apagado
    neonEl.querySelectorAll('.nchar').forEach(sp => {
      sp.style.textShadow = 'none';
      sp.style.color = '';
    });
    if(S.backing) drawAcrylic();
    return;
  }

  const c = (S.rgb && rgbInt) ? currentRGBColor : S.color;
  neonEl.style.color = c;
  neonEl.style.textShadow = `0 0 5px ${c},0 0 10px ${c},0 0 20px ${c},0 0 40px ${c},0 0 80px ${c}`;

  buildNeonSpans();

  if(S.backing) drawAcrylic();
}

function updateDimBadge(){
  const cmW = Math.round(40 * S.scale);
  document.getElementById('dimBadge').textContent = `~ ${cmW} √ó ${Math.round(cmW*.38)} cm`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// POSITION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function applyTransform(){
  signWrapper.style.left      = `calc(50% + ${S.posX}px)`;
  signWrapper.style.top       = `calc(50% + ${S.posY}px)`;
  signWrapper.style.transform = `translate(-50%,-50%) scale(${S.scale})`;
}
function resetPosition(){ S.posX=0; S.posY=0; S.scale=1; renderNeon(); updateDimBadge(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MOUNT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function applyMount(){
  mountPlate.style.cssText=''; mountHook.style.display='none';
  mountBase.style.display='none'; mountScrews.style.display='none';

  // Montajes con placa propia ocultan el backing acr√≠lico para evitar sobreposici√≥n
  const hasPlate = ['acrilico-cuadrado','acrilico-redondo','colgar'].includes(S.mount);
  if(hasPlate && S.backing){
    acrylicCvs.style.opacity='0';
  } else if(S.backing){
    drawAcrylic();
  }

  if(S.mount==='colgar'){
    mountHook.style.cssText='display:block;position:absolute;left:50%;top:-70px;transform:translateX(-50%);width:2px;height:70px;background:repeating-linear-gradient(to bottom,#aaa 0,#aaa 4px,#888 4px,#888 8px);box-shadow:0 0 4px rgba(0,0,0,.5);';
    mountPlate.style.cssText='position:absolute;inset:-18px -22px;border-radius:10px;background:linear-gradient(160deg,rgba(220,230,245,.18) 0%,rgba(180,195,220,.12) 50%,rgba(200,215,235,.16) 100%);opacity:1;backdrop-filter:blur(1px);box-shadow:0 4px 28px rgba(0,0,0,.55),inset 0 0 0 1.5px rgba(255,255,255,.22),inset 0 1px 0 rgba(255,255,255,.35);';
  }

  if(S.mount==='acrilico-cuadrado'){
    mountPlate.style.cssText='position:absolute;inset:-18px -22px;border-radius:10px;background:linear-gradient(160deg,rgba(220,230,245,.18) 0%,rgba(180,195,220,.12) 50%,rgba(200,215,235,.16) 100%);opacity:1;backdrop-filter:blur(1px);box-shadow:0 4px 28px rgba(0,0,0,.55),inset 0 0 0 1.5px rgba(255,255,255,.22),inset 0 1px 0 rgba(255,255,255,.35);';
  }

  if(S.mount==='acrilico-redondo'){
    const w=signWrapper.offsetWidth+44, h=signWrapper.offsetHeight+44;
    const side=Math.max(w,h);
    const offsetX=(w-side)/2-22, offsetY=(h-side)/2-22;
    mountPlate.style.cssText='position:absolute;width:'+side+'px;height:'+side+'px;left:'+offsetX+'px;top:'+offsetY+'px;border-radius:50%;background:linear-gradient(160deg,rgba(220,230,245,.18) 0%,rgba(180,195,220,.12) 50%,rgba(200,215,235,.16) 100%);opacity:1;backdrop-filter:blur(1px);box-shadow:0 4px 28px rgba(0,0,0,.55),inset 0 0 0 1.5px rgba(255,255,255,.22),inset 0 1px 0 rgba(255,255,255,.35);';
  }
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHAR EDITOR ‚Äî click en letra ‚Üí mini men√∫
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const FONTS_LIST = [
  {k:'Pacifico',   l:'Pacifico'},
  {k:'Dancing Script', l:'Dancing'},
  {k:'Satisfy',    l:'Satisfy'},
  {k:'Permanent Marker', l:'Marker'},
  {k:'Sacramento', l:'Sacramento'},
  {k:'Great Vibes',l:'Great Vibes'},
  {k:'Lobster',    l:'Lobster'},
  {k:'Abril Fatface',l:'Abril'},
  {k:'Righteous',  l:'Righteous'},
  {k:'Orbitron',   l:'ORBITRON'},
];
const COLORS_LIST = [
  {c:'#b3f0ff',n:'Azul Hielo'},{c:'#ff2222',n:'Roja'},{c:'#ffb300',n:'Amber'},
  {c:'#e8ff00',n:'Amarillo Lim√≥n'},{c:'#bf00ff',n:'Morado'},{c:'#00ff88',n:'Verde'},
  {c:'#39ff14',n:'Verde Mars'},{c:'#3b82f6',n:'Azul'},{c:'#ff3cac',n:'Rosa'},
  {c:'#ffd700',n:'Amarillo Dorado'},{c:'#ff8800',n:'Naranja'},{c:'#e8f4ff',n:'Blanca Fr√≠a'},
];

const charMenu      = document.getElementById('charMenu');
const cmenuFontName = document.getElementById('cmenuFontName');
const cmenuColorBtn = document.getElementById('cmenuColorBtn');
const cmenuColorSub = document.getElementById('cmenuColorSub');
let activeCharIdx   = null;
let cmenuFontIdx    = 0;   // √≠ndice actual en FONTS_LIST

// Poblar submenu de colores
COLORS_LIST.forEach(col => {
  const sw = document.createElement('div');
  sw.className = 'cmenu-csw';
  sw.style.background = col.c;
  sw.title = col.n;
  sw.dataset.color = col.c;
  cmenuColorSub.appendChild(sw);
});

function openCharMenu(spanEl){
  const idx = parseInt(spanEl.dataset.idx);
  activeCharIdx = idx;

  neonEl.querySelectorAll('.nchar.selected').forEach(s => s.classList.remove('selected'));
  spanEl.classList.add('selected');

  const ov       = S.charOverrides[idx] || {};
  const curFont  = ov.font  || S.font;
  const curColor = ov.color || S.color;

  // Posicionar carrusel en la fuente activa
  cmenuFontIdx = FONTS_LIST.findIndex(f => f.k === curFont);
  if(cmenuFontIdx < 0) cmenuFontIdx = 0;
  updateFontCarousel();

  // Color activo
  cmenuColorBtn.style.background = curColor;
  cmenuColorSub.querySelectorAll('.cmenu-csw').forEach(s =>
    s.classList.toggle('on', s.dataset.color === curColor)
  );
  cmenuColorSub.classList.remove('open');

  // Posicionar el men√∫ encima del span
  const wRect = signWrapper.getBoundingClientRect();
  const sRect = spanEl.getBoundingClientRect();
  const sc    = S.scale;
  const cx    = (sRect.left + sRect.width / 2 - wRect.left) / sc;
  const ty    = (sRect.top - wRect.top) / sc - 14;

  charMenu.style.left      = cx + 'px';
  charMenu.style.top       = ty + 'px';
  charMenu.style.transform = 'translateX(-50%) translateY(-100%)';
  charMenu.classList.add('visible');
}

function closeCharMenu(){
  charMenu.classList.remove('visible');
  cmenuColorSub.classList.remove('open');
  neonEl.querySelectorAll('.nchar.selected').forEach(s => s.classList.remove('selected'));
  activeCharIdx = null;
}

function updateFontCarousel(){
  const f = FONTS_LIST[cmenuFontIdx];
  cmenuFontName.textContent   = f.l;
  cmenuFontName.style.fontFamily = `'${f.k}', cursive`;
}

function applyCarouselFont(){
  if(activeCharIdx === null) return;
  if(!S.charOverrides[activeCharIdx]) S.charOverrides[activeCharIdx] = {};
  S.charOverrides[activeCharIdx].font = FONTS_LIST[cmenuFontIdx].k;
  renderNeon();
}

// Flechas carrusel
document.getElementById('cmenuPrev').addEventListener('click', e => {
  e.stopPropagation();
  cmenuFontIdx = (cmenuFontIdx - 1 + FONTS_LIST.length) % FONTS_LIST.length;
  updateFontCarousel(); applyCarouselFont();
});
document.getElementById('cmenuNext').addEventListener('click', e => {
  e.stopPropagation();
  cmenuFontIdx = (cmenuFontIdx + 1) % FONTS_LIST.length;
  updateFontCarousel(); applyCarouselFont();
});

// Abrir/cerrar submenu color
cmenuColorBtn.addEventListener('click', e => {
  e.stopPropagation();
  cmenuColorSub.classList.toggle('open');
});

// Seleccionar color
cmenuColorSub.addEventListener('click', e => {
  const sw = e.target.closest('.cmenu-csw'); if(!sw) return;
  e.stopPropagation();
  if(activeCharIdx === null) return;
  if(!S.charOverrides[activeCharIdx]) S.charOverrides[activeCharIdx] = {};
  S.charOverrides[activeCharIdx].color = sw.dataset.color;
  cmenuColorBtn.style.background = sw.dataset.color;
  cmenuColorSub.querySelectorAll('.cmenu-csw').forEach(s => s.classList.toggle('on', s === sw));
  cmenuColorSub.classList.remove('open');
  renderNeon();
});

// Reset
document.getElementById('cmenuReset').addEventListener('click', e => {
  e.stopPropagation();
  if(activeCharIdx === null) return;
  delete S.charOverrides[activeCharIdx];
  closeCharMenu();
  renderNeon();
});

document.addEventListener('pointerdown', e => {
  if(!charMenu.classList.contains('visible')) return;
  if(charMenu.contains(e.target)) return;
  if(e.target.closest('.nchar')) return;
  closeCharMenu();
});

// Cerrar al empezar a arrastrar el letrero
signWrapper.addEventListener('pointermove', () => {
  if(dragging) closeCharMenu();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DRAG ‚Äî letrero
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let dragging=false, dragStartX=0, dragStartY=0, posAtDragX=0, posAtDragY=0;
let pointerDownTarget=null;  // guardamos target ANTES de setPointerCapture
signWrapper.addEventListener('pointerdown',e=>{
  if(e.target.closest('#resizeHandle')) return;
  pointerDownTarget=e.target;  // el target real (puede ser un .nchar)
  charPointerMoved=false;
  dragging=true; dragStartX=e.clientX; dragStartY=e.clientY;
  posAtDragX=S.posX; posAtDragY=S.posY;
  signWrapper.setPointerCapture(e.pointerId); e.preventDefault(); e.stopPropagation();
});
signWrapper.addEventListener('pointermove',e=>{
  if(!dragging) return;
  const dx=e.clientX-dragStartX, dy=e.clientY-dragStartY;
  if(Math.abs(dx)>4||Math.abs(dy)>4) charPointerMoved=true;
  S.posX=posAtDragX+dx;
  S.posY=posAtDragY+dy;
  applyTransform();
});
signWrapper.addEventListener('pointerup',e=>{
  dragging=false;
  // Usar el target guardado en pointerdown (setPointerCapture lo sobreescribe en e.target)
  if(!charPointerMoved){
    const sp=pointerDownTarget && pointerDownTarget.closest('.nchar');
    if(sp) openCharMenu(sp);
  }
  pointerDownTarget=null;
});

// DRAG ‚Äî fondo
let bgDragging=false, bgStartX=0, bgStartY=0, bgAtX=50, bgAtY=50;
previewCanvas.addEventListener('pointerdown',e=>{
  if(e.target.closest('#signWrapper')) return;
  bgDragging=true; bgStartX=e.clientX; bgStartY=e.clientY; bgAtX=S.bgX; bgAtY=S.bgY;
  previewCanvas.style.cursor='grabbing'; previewCanvas.setPointerCapture(e.pointerId);
});
previewCanvas.addEventListener('pointermove',e=>{
  if(!bgDragging) return;
  S.bgX=Math.max(0,Math.min(100,bgAtX-(e.clientX-bgStartX)*.04));
  S.bgY=Math.max(0,Math.min(100,bgAtY-(e.clientY-bgStartY)*.04));
  previewCanvas.style.backgroundPosition=`${S.bgX}% ${S.bgY}%`;
});
previewCanvas.addEventListener('pointerup',()=>{ bgDragging=false; previewCanvas.style.cursor='default'; });

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RESIZE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const rHandle=document.getElementById('resizeHandle');
let resizing=false, resizeStartX=0, scaleAtResize=1;
rHandle.addEventListener('pointerdown',e=>{ resizing=true; resizeStartX=e.clientX; scaleAtResize=S.scale; rHandle.setPointerCapture(e.pointerId); e.stopPropagation(); e.preventDefault(); });
rHandle.addEventListener('pointermove',e=>{ if(!resizing)return; S.scale=Math.max(.15,Math.min(3,scaleAtResize+(e.clientX-resizeStartX)*.006)); renderNeon(); updateDimBadge(); });
rHandle.addEventListener('pointerup',()=>{ resizing=false; });

previewCanvas.addEventListener('wheel',e=>{ e.preventDefault(); S.scale=Math.max(.15,Math.min(3,S.scale-e.deltaY*.001)); renderNeon(); updateDimBadge(); },{passive:false});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PINCH TO ZOOM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let lastPinchDist=null;
previewCanvas.addEventListener('touchstart',e=>{ if(e.touches.length===2){lastPinchDist=getPinchDist(e.touches);e.preventDefault();} },{passive:false});
previewCanvas.addEventListener('touchmove',e=>{ if(e.touches.length===2&&lastPinchDist!==null){ const d=getPinchDist(e.touches); S.scale=Math.max(.15,Math.min(3,S.scale+(d-lastPinchDist)*.005)); lastPinchDist=d; renderNeon(); updateDimBadge(); e.preventDefault(); } },{passive:false});
previewCanvas.addEventListener('touchend',e=>{ if(e.touches.length<2)lastPinchDist=null; });
function getPinchDist(t){return Math.hypot(t[0].clientX-t[1].clientX,t[0].clientY-t[1].clientY);}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONTROLS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('textInput').addEventListener('input',function(){
  const v=this.value.slice(0,60); this.value=v; S.text=v;
  document.getElementById('charCount').textContent=v.length+' caracteres';
  S.charOverrides={}; closeCharMenu(); recalcFontSize(); updateDimBadge(); dots();
});
document.getElementById('fontGrid').addEventListener('click',e=>{
  const b=e.target.closest('.fbtn'); if(!b)return;
  document.querySelectorAll('.fbtn').forEach(x=>x.classList.remove('on'));
  b.classList.add('on'); S.font=b.dataset.font; recalcFontSize(); dots();
});
document.getElementById('colorGrid').addEventListener('click',e=>{
  const s=e.target.closest('.cswatch'); if(!s)return;
  document.querySelectorAll('.cswatch').forEach(x=>x.classList.remove('on'));
  s.classList.add('on'); S.color=s.dataset.c;
  document.getElementById('colorLabel').textContent=s.dataset.n;
  renderNeon(); dots();
});
document.getElementById('wallGrid').addEventListener('click',e=>{
  const b=e.target.closest('.wbtn'); if(!b)return;
  document.querySelectorAll('.wbtn').forEach(x=>x.classList.remove('on'));
  b.classList.add('on');
  previewCanvas.style.backgroundImage=`url('${b.dataset.url}')`;
  overlay.style.background=`rgba(0,0,0,${b.dataset.ov})`;
  dots();
});
document.getElementById('mountGrid').addEventListener('click',e=>{
  const b=e.target.closest('.mbtn'); if(!b)return;
  document.querySelectorAll('.mbtn').forEach(x=>x.classList.remove('on'));
  b.classList.add('on'); S.mount=b.dataset.m;
  // Si se vuelve a "libre", restaurar el backing si estaba activo
  if(S.mount==='libre' && S.backing) drawAcrylic();
  applyMount(); dots();
});

document.getElementById('tBacking').addEventListener('change',function(){
  S.backing=this.checked;
  if(S.backing){
    // Quitar montaje para evitar sobreposici√≥n
    if(S.mount!=='libre'){
      S.mount='libre';
      document.querySelectorAll('.mbtn').forEach(x=>x.classList.remove('on'));
      document.querySelector('.mbtn[data-m="libre"]').classList.add('on');
      mountPlate.style.cssText=''; mountHook.style.display='none';
      mountBase.style.display='none'; mountScrews.style.display='none';
    }
    drawAcrylic();
  } else {
    acrylicCvs.style.opacity='0';
  }
  dots();
});
document.getElementById('tRgb').addEventListener('change',function(){ S.rgb=this.checked; this.checked?startRGB():stopRGB(); dots(); });
document.getElementById('tFlicker').addEventListener('change',function(){ S.flicker=this.checked; neonEl.classList.toggle('flicker',this.checked); dots(); });
document.getElementById('tDimmer').addEventListener('change',function(){ S.dimmer=this.checked; neonEl.classList.toggle('dimmed',this.checked); dots(); });

document.getElementById('tPower').addEventListener('change',function(){
  S.power=this.checked;
  if(this.checked){ renderNeon(); neonEl.classList.toggle('flicker',S.flicker); neonEl.classList.toggle('dimmed',S.dimmer); }
  else { neonEl.style.color='#5a5a5a'; neonEl.style.textShadow='none'; neonEl.classList.remove('flicker','dimmed'); if(S.backing)drawAcrylic(); }
});

function toggleFlicker(){
  const t=document.getElementById('tFlicker');
  t.checked=!t.checked; S.flicker=t.checked; neonEl.classList.toggle('flicker',t.checked); dots();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RAIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let rainAF=null;
const drops=[];
function initRain(){
  const w=previewCanvas.offsetWidth,h=previewCanvas.offsetHeight;
  rainCvs.width=w; rainCvs.height=h; drops.length=0;
  for(let i=0;i<120;i++) drops.push({x:Math.random()*w,y:Math.random()*h,len:8+Math.random()*14,speed:6+Math.random()*8,op:.15+Math.random()*.35});
}
function drawRain(){
  const w=rainCvs.width,h=rainCvs.height;
  rainCtx.clearRect(0,0,w,h); rainCtx.strokeStyle='rgba(180,220,255,.55)'; rainCtx.lineWidth=1;
  drops.forEach(d=>{
    rainCtx.globalAlpha=d.op; rainCtx.beginPath(); rainCtx.moveTo(d.x,d.y); rainCtx.lineTo(d.x+d.len*.18,d.y+d.len); rainCtx.stroke();
    d.y+=d.speed; d.x+=d.speed*.18; if(d.y>h){d.y=-d.len;d.x=Math.random()*w;}
  });
  rainCtx.globalAlpha=1;
}
function startRain(){ initRain(); (function loop(){ drawRain(); rainAF=requestAnimationFrame(loop); })(); }
function stopRain(){ cancelAnimationFrame(rainAF); rainCtx.clearRect(0,0,rainCvs.width,rainCvs.height); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DOWNLOAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function downloadPreview(){
  const cvs=document.createElement('canvas'); cvs.width=1400; cvs.height=700;
  const ctx=cvs.getContext('2d');
  ctx.fillStyle='#111'; ctx.fillRect(0,0,1400,700);
  const lines=S.text.split('\n'), mx=Math.max(...lines.map(l=>l.length),1);
  const fs=Math.max(44,Math.min(180,900/mx));
  ctx.font=`${fs}px '${S.font}'`; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillStyle=S.color;
  const lh=fs*1.3, sy=350-((lines.length-1)*lh)/2;
  lines.forEach((ln,i)=>{ ctx.shadowColor=S.color; for(let g=0;g<5;g++){ctx.shadowBlur=18*(g+1);ctx.fillText(ln,700,sy+i*lh);} });
  const a=document.createElement('a'); a.download='mi-neon.png'; a.href=cvs.toDataURL(); a.click();
}

function shareDesign(){
  const p=new URLSearchParams({t:S.text,f:S.font,c:S.color});
  const url=location.href.split('?')[0]+'?'+p;
  navigator.clipboard.writeText(url).then(()=>{
    const b=document.getElementById('btnShare');
    b.textContent='‚úì ¬°Copiado!';
    setTimeout(()=>b.innerHTML='üîó <span class="btn-text">Compartir</span>',2500);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DOTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function dots(){
  const checks=[
    S.text.trim().length>0, S.font!=='Pacifico', S.color!=='#b3f0ff',
    !!document.querySelector('.wbtn.on:not(:first-child)'),
    S.mount!=='libre',
    S.backing||S.rgb||S.flicker||S.dimmer,
  ];
  checks.forEach((ok,i)=>document.getElementById('d'+(i+1)).classList.toggle('on',ok));
  document.getElementById('d1').classList.add('on');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MOBILE SHEET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const isMobile=()=>window.innerWidth<=768;
const SHEET_COLLAPSED=52, SHEET_HALF=220, SHEET_FULL=380;
let sheetH=SHEET_COLLAPSED, sheetOpen=false;

function initMobileSheet(){
  if(!isMobile()) return;
  const handle=document.getElementById('sheetHandle');
  const tabsEl=document.getElementById('sheetTabs');
  const blocks=document.querySelectorAll('.block[data-tab]');
  const sh=document.getElementById('scrollHint');
  handle.style.display='flex'; tabsEl.style.display='flex';
  if(sh) sh.textContent='‚úåÔ∏è Pellizca para redimensionar';
  tabsEl.innerHTML='';
  blocks.forEach((b,i)=>{
    const btn=document.createElement('button');
    btn.className='stab'+(i===0?' on':'');
    btn.textContent=b.dataset.tab;
    btn.addEventListener('click',()=>switchTab(i));
    tabsEl.appendChild(btn);
  });
  switchTab(0);
  if(handle._init) return; handle._init=true;
  handle.addEventListener('click',()=>{ sheetOpen=!sheetOpen; setSheetHeight(sheetOpen?SHEET_HALF:SHEET_COLLAPSED); });
  let sheetDragStartY=0, sheetHAtStart=0, sheetDragging=false;
  handle.addEventListener('pointerdown',e=>{ sheetDragging=true; sheetDragStartY=e.clientY; sheetHAtStart=sheetH; handle.setPointerCapture(e.pointerId); e.stopPropagation(); });
  handle.addEventListener('pointermove',e=>{ if(!sheetDragging)return; setSheetHeight(Math.max(SHEET_COLLAPSED,Math.min(SHEET_FULL,sheetHAtStart+(sheetDragStartY-e.clientY))),false); });
  handle.addEventListener('pointerup',()=>{ sheetDragging=false; const snaps=[SHEET_COLLAPSED,SHEET_HALF,SHEET_FULL]; const cl=snaps.reduce((a,b)=>Math.abs(b-sheetH)<Math.abs(a-sheetH)?b:a); setSheetHeight(cl); sheetOpen=cl>SHEET_COLLAPSED; });
}

function setSheetHeight(h,animate=true){
  sheetH=h;
  const sb=document.getElementById('sidebar');
  sb.style.transition=animate?'height .3s cubic-bezier(.4,0,.2,1)':'none';
  sb.style.height=h+'px';
}
function switchTab(idx){
  document.querySelectorAll('.block[data-tab]').forEach((b,i)=>b.classList.toggle('active',i===idx));
  document.querySelectorAll('.stab').forEach((t,i)=>t.classList.toggle('on',i===idx));
  if(isMobile()&&sheetH<SHEET_HALF){setSheetHeight(SHEET_HALF);sheetOpen=true;}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// URL PARAMS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function(){
  const p=new URLSearchParams(location.search);
  if(p.get('t')){S.text=p.get('t');document.getElementById('textInput').value=S.text;}
  if(p.get('f')) S.font=p.get('f');
  if(p.get('c')) S.color=p.get('c');
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RESIZE OBSERVER
// Solo actualiza la posici√≥n/transform ‚Äî NO recalcula font-size.
// El tama√±o del texto solo cambia cuando el usuario edita el texto o la fuente.
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
if(window.ResizeObserver){
  new ResizeObserver(()=> applyTransform()).observe(previewCanvas);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WINDOW RESIZE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('resize',()=>{
  if(isMobile()){
    initMobileSheet();
  } else {
    const sb=document.getElementById('sidebar');
    sb.style.height=''; sb.style.transition='';
    document.querySelectorAll('.block').forEach(b=>{b.style.display='';b.classList.remove('active');});
    document.getElementById('sheetHandle').style.display='none';
    document.getElementById('sheetTabs').style.display='none';
  }
  // Solo actualiza posici√≥n, NO el font-size
  applyTransform();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
recalcFontSize();  // calcula currentFS seg√∫n el canvas inicial, luego renderiza
applyMount();
dots();
initMobileSheet();
</script>
</body>
</html>
